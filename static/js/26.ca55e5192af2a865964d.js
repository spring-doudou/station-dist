webpackJsonp([26],{LVFR:function(t,e,i){e=t.exports=i("FZ+f")(!1),e.push([t.i,".amap-demo{height:100%}.amap-wrapper{width:100%;height:100%}",""])},Xchn:function(t,e,i){"use strict";var r=i("n4NU");e.a={data:function(){return{tableHeight2:0,tableHeight:0,height:{width:"100%",height:""},height2:{width:"100%",height:"",overflow:"auto"},dialogVisible:!1,users:[],stations:[],zoom:12,center:[121.59996,31.197646],markers:[],markerStation:[],markerRefs:[],source:"click",plugin:[{pName:"ToolBar",events:{init:function(t){console.log(t)}}}],searchStation:"",currentRow:null,orderDistance:{orderNumber:"",startTime:new Date,endTime:new Date,stationName:"",userName:"",distance:0,userId:0,stationId:0}}},created:function(){this.hh(),this.getUsers(""),this.getStaions("")},methods:{hh:function(){this.height.height=window.innerHeight-85+"px",this.height2.height=window.innerHeight-85+"px",this.tableHeight=window.innerHeight-85,this.tableHeight2=window.innerHeight-153},setCurrent:function(t){this.$refs.singleTable.setCurrentRow(t)},handleCurrentChange:function(t){null!=t&&(this.users.forEach(function(t){t.isCurrent=0}),t.isCurrent=1,this.currentRow=t)},handler:function(t){alert(t+"-trigger")},getUsers:function(t){var e=this,n=this.$store.state.area.currentArea.id;i.i(r.a)(n,t).then(function(t){var i=t.result;e.users=i,e.users.forEach(function(t){var i="("+t.waitToAcceptCount+","+t.waitToStationCount+","+t.workingCount+")";e.markers.push({position:[t.longitude,t.latitude],user:t,id:t.id,badgeValue:i})}),e.currentRow=null})},handleAssign:function(t){var e=this;null==this.currentRow?this.$message.error("请先选择工作人员进行指派"):i.i(r.i)(this.currentRow.id,t.id).then(function(t){var i=t.result;e.orderDistance={startTime:new Date,endTime:new Date((new Date).getTime()+1e3*i.distance/8),stationName:i.stationName,userName:i.userName,distance:i.distance,userId:i.userId,stationId:i.stationId,orderNumber:""},e.dialogVisible=!0}),console.log(t)},handleClose:function(t){this.$confirm("确认关闭？").then(function(e){t()}).catch(function(t){})},getStaions:function(t){var e=this,n=this.$store.state.area.currentArea.id;i.i(r.b)(n,t).then(function(t){var i=t.result;e.stations=i,e.stations.length>0&&(e.center=[e.stations[0].longitude,e.stations[0].latitude]),e.stations.forEach(function(t){e.markerStation.push({position:[t.longitude,t.latitude],id:t.id,station:t})})})},endTimeChange:function(){this.orderDistance.endTime=new Date(this.orderDistance.startTime.getTime()+1e3*this.orderDistance.distance/8)},refresh:function(){this.getUsers(""),this.getStaions("")},handleChangeStation:function(){this.getStaions(this.searchStation)},handleAddStation:function(){this.$router.push({path:"addStation"})},handleJumpToAccept:function(){this.$router.push({path:"waitToAccept"})},handleJumpToLoc:function(){this.$router.push({path:"waitToLoc"})},handleJumpToWork:function(){this.$router.push({path:"working"})},handleSaveOrder:function(){var t=this,e={orderNumber:this.orderDistance.orderNumber,stationId:this.orderDistance.stationId,userId:this.orderDistance.userId,areaId:this.$store.state.area.currentArea.id,startTime:this.orderDistance.startTime.getTime(),endTime:this.orderDistance.endTime.getTime()};i.i(r.g)(e).then(function(e){t.dialogVisible=!1,t.refresh()})}}}},kawj:function(t,e,i){var r=i("LVFR");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);i("rjj0")("5bc2ac0d",r,!0)},mazP:function(t,e,i){"use strict";function r(t){i("kawj")}Object.defineProperty(e,"__esModule",{value:!0});var n=i("Xchn"),a=i("o3jx"),o=i("VU/8"),s=r,l=o(n.a,a.a,s,null,null);e.default=l.exports},n4NU:function(t,e,i){"use strict";function r(t,e){return i.i(h.a)({url:"/web_api/v1/users?areaId="+t+"&text="+e,method:"get"})}function n(){return i.i(h.a)({url:"/web_api/v1/stations",method:"get"})}function a(t,e,r,n){return i.i(h.a)({url:"/web_api/v1/order?areaId="+t+"&userId="+e+"&stationId="+r+"&status="+n,method:"get"})}function o(t,e){return i.i(h.a)({url:"/web_api/v1/order/distance?userId="+t+"&stationId="+e,method:"get"})}function s(t){return i.i(h.a)({url:"/web_api/v1/order",method:"post",data:{orderNumber:t.orderNumber,stationId:t.stationId,userId:t.userId,areaId:t.areaId,startTime:t.startTime,endTime:t.endTime}})}function l(t){return i.i(h.a)({url:"/web_api/v1/station",method:"post",data:t})}function d(t){return i.i(h.a)({url:"/web_api/v1/station?id="+t,method:"delete"})}function c(t){return i.i(h.a)({url:"/web_api/v1/order/markException",method:"put",data:{id:t.id,remark:t.remark}})}function u(t){return i.i(h.a)({url:"/web_api/v1/order",method:"put",data:{id:t.id,startTime:t.startTime,endTime:t.endTime,orderNumber:t.orderNumber}})}e.a=r,e.b=n,e.c=a,e.i=o,e.g=s,e.h=l,e.f=d,e.e=c,e.d=u;var h=i("Vo7i")},o3jx:function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("el-row",{staticStyle:{height:"100%"},attrs:{gutter:20}},[i("el-col",{staticStyle:{height:"100%"},attrs:{span:4}},[i("div",{staticStyle:{width:"100%",height:"100%"}},[i("el-table",{ref:"singleTable",attrs:{data:t.users,"highlight-current-row":"","show-header":!1,border:!0,height:t.tableHeight},on:{"current-change":t.handleCurrentChange}},[i("el-table-column",{attrs:{label:""},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticStyle:{"border-bottom":"1px"}},[i("div",{staticStyle:{font:"18px large"}},[t._v(t._s(e.row.name)+"\n                  "),1===e.row.isCurrent?i("icon-svg",{staticStyle:{float:"right"},attrs:{"icon-class":"selected"}}):t._e()],1),t._v(" "),i("div",{staticStyle:{font:"16px Medium"}},[t._v(t._s(e.row.mobile))]),t._v(" "),i("div",{staticStyle:{font:"16px Medium"}},[t._v("待接任务："+t._s(e.row.waitToAcceptCount))]),t._v(" "),i("div",{staticStyle:{font:"16px Medium"}},[t._v("待到地点："+t._s(e.row.waitToStationCount))]),t._v(" "),i("div",{staticStyle:{font:"16px Medium"}},[t._v("工作中："+t._s(e.row.workingCount))])])]}}])})],1)],1)]),t._v(" "),i("el-col",{staticStyle:{height:"100%"},attrs:{span:16}},[i("div",{staticClass:"grid-content bg-purple",staticStyle:{width:"100%",height:"100%"}},[i("div",{staticClass:"amap-wrapper",style:t.height},[i("el-amap",{staticClass:"amap-demo",staticStyle:{width:"100%",height:"100%"},attrs:{plugin:t.plugin,vid:"amapDemo1",center:t.center,zoom:t.zoom,"resize-enable":!0}},[t._l(t.markers,function(e){return i("el-amap-marker",{key:e.id,attrs:{position:e.position}},[i("el-popover",{ref:e.id,refInFor:!0,attrs:{placement:"right",width:"200",trigger:"hover"}},[i("div",[i("div",[i("div",{staticStyle:{font:"18px large"}},[t._v(t._s(e.user.name))]),t._v(" "),i("div",{staticStyle:{font:"16px Medium"}},[t._v(t._s(e.user.mobile))]),t._v(" "),i("el-row",[i("el-button",{staticStyle:{font:"16px Medium"},attrs:{type:"text"},on:{click:t.handleJumpToAccept}},[t._v("\n                        待接任务："+t._s(e.user.waitToAcceptCount)+"\n                      ")])],1),t._v(" "),i("el-row",[i("el-button",{staticStyle:{font:"16px Medium"},attrs:{type:"text"},on:{click:t.handleJumpToLoc}},[t._v("\n                        待到地点："+t._s(e.user.waitToStationCount)+"\n                      ")])],1),t._v(" "),i("el-row",[i("el-button",{staticStyle:{font:"16px Medium"},attrs:{type:"text"},on:{click:t.handleJumpToWork}},[t._v("\n                        工作中："+t._s(e.user.workingCount)+"\n                      ")])],1)],1)]),t._v(" "),i("el-button",{attrs:{slot:"reference",type:"primary",size:"mini"},slot:"reference"},[t._v("\n                  "+t._s(e.user.name)+t._s(e.badgeValue)+"\n                ")])],1)],1)}),t._v(" "),t._l(t.markerStation,function(e){return i("el-amap-marker",{key:e.id,attrs:{position:e.position}},[i("el-popover",{attrs:{placement:"right",width:"200",trigger:"hover"}},[i("div",[null==t.currentRow?i("div",[i("div",[t._v(t._s(e.station.address))])]):i("div",[i("div",{staticStyle:{font:"18px large"}},[t._v(t._s(t.currentRow.name))]),t._v(" "),i("div",{staticStyle:{font:"16px Medium"}},[t._v(t._s(t.currentRow.mobile))]),t._v(" "),i("div",{staticStyle:{font:"16px Medium"}},[t._v("待接任务："+t._s(t.currentRow.waitToAcceptCount))]),t._v(" "),i("div",{staticStyle:{font:"16px Medium"}},[t._v("待到地点："+t._s(t.currentRow.waitToStationCount))]),t._v(" "),i("div",{staticStyle:{font:"16px Medium"}},[t._v("工作中："+t._s(t.currentRow.workingCount))]),t._v(" "),i("div",{staticStyle:{font:"16px Medium"}},[t._v("详细地址："+t._s(e.station.address))]),t._v(" "),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(i){t.handleAssign(e.station)}}},[t._v("指派")])],1)]),t._v(" "),i("el-button",{attrs:{slot:"reference",type:"warning",round:"",size:"mini"},slot:"reference"},[t._v("\n                  "+t._s(e.station.name)+"\n                ")])],1)],1)})],2)],1)])]),t._v(" "),i("el-col",{staticStyle:{height:"100%"},attrs:{span:4}},[i("div",{staticStyle:{width:"100%",height:"100%"}},[i("el-input",{attrs:{size:"mini",placeholder:"搜索"},on:{change:t.handleChangeStation},model:{value:t.searchStation,callback:function(e){t.searchStation=e},expression:"searchStation"}}),t._v(" "),i("el-table",{ref:"singleTable",attrs:{data:t.stations,"show-header":!1,border:!0,height:t.tableHeight2}},[i("el-table-column",{attrs:{align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-popover",{attrs:{trigger:"hover",placement:"top"}},[i("el-button",{attrs:{size:"mini"},on:{click:function(i){t.handleAssign(e.row)}}},[t._v("指派\n                ")]),t._v(" "),i("div",{attrs:{slot:"reference"},slot:"reference"},[i("div",{staticStyle:{font:"18px large"}},[t._v(t._s(e.row.name))]),t._v(" "),i("div",{staticStyle:{font:"16px Medium"}},[t._v(t._s(e.row.address))])])],1)]}}])})],1),t._v(" "),i("el-row",[i("el-button",{staticStyle:{width:"100%","vertical-align":"bottom"},attrs:{type:"primary",plain:""},on:{click:t.handleAddStation}},[t._v("添加站点\n          ")])],1)],1)])],1),t._v(" "),i("el-dialog",{attrs:{title:"指派任务",visible:t.dialogVisible,width:"60%","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{ref:"orderDistance",attrs:{model:t.orderDistance,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"操作票编号"}},[i("el-input",{attrs:{rules:[{required:!0,message:"操作票编号不能为空"}]},model:{value:t.orderDistance.orderNumber,callback:function(e){t.$set(t.orderDistance,"orderNumber",e)},expression:"orderDistance.orderNumber"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"工作地点"}},[i("el-input",{attrs:{readonly:!0},model:{value:t.orderDistance.stationName,callback:function(e){t.$set(t.orderDistance,"stationName",e)},expression:"orderDistance.stationName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"工作人员"}},[i("el-input",{attrs:{readonly:!0},model:{value:t.orderDistance.userName,callback:function(e){t.$set(t.orderDistance,"userName",e)},expression:"orderDistance.userName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"距离(km)"}},[i("el-input",{attrs:{readonly:!0},model:{value:t.orderDistance.distance/1e3,callback:function(e){t.$set(t.orderDistance,"distance/1000",e)},expression:"orderDistance.distance/1000"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"出发时间"}},[i("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间",rules:[{required:!0,message:"出发时间不能为空"}]},on:{change:t.endTimeChange},model:{value:t.orderDistance.startTime,callback:function(e){t.$set(t.orderDistance,"startTime",e)},expression:"orderDistance.startTime"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"到达时间"}},[i("el-date-picker",{attrs:{readonly:!0,type:"datetime",placeholder:"选择日期时间"},model:{value:t.orderDistance.endTime,callback:function(e){t.$set(t.orderDistance,"endTime",e)},expression:"orderDistance.endTime"}})],1)],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.handleSaveOrder}},[t._v("保存")])],1)],1)],1)},n=[],a={render:r,staticRenderFns:n};e.a=a}});